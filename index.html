<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift Scheduler and Tax Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .day-container {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            padding: 10px;
        }
        .shift-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        button {
            padding: 5px 10px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #0056b3;
        }
        .output {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Shift Scheduler and Tax Calculator</h1>
    <div id="shiftScheduler">
        <!-- Days will be added dynamically -->
    </div>
    <button onclick="saveWeek()">Save Shifts for the Week</button>
    <button onclick="calculateEarnings()">Calculate Earnings</button>
    <button onclick="viewHistory()">View Saved Data</button>

    <div id="output" class="output"></div>

    <script>
        const weekdays = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
        const shifts = {};
        const savedData = [];

        // Initialize scheduler
        function initScheduler() {
            const container = document.getElementById("shiftScheduler");
            weekdays.forEach(day => {
                const dayContainer = document.createElement("div");
                dayContainer.className = "day-container";
                dayContainer.innerHTML = `
                    <h3>${day}</h3>
                    <button onclick="addShift('${day}')">Add Shift</button>
                    <button onclick="markNotWorked('${day}')">Not Worked</button>
                    <div id="${day}-shifts"></div>
                `;
                container.appendChild(dayContainer);
            });
        }

        // Add a shift for a day
        function addShift(day) {
            const shiftsContainer = document.getElementById(`${day}-shifts`);
            const shiftDiv = document.createElement("div");
            shiftDiv.className = "shift-container";
            shiftDiv.innerHTML = `
                Start: <input type="time" required> End: <input type="time" required>
                <button onclick="removeShift(this)">Remove</button>
            `;
            shiftsContainer.appendChild(shiftDiv);
        }

        // Mark a day as not worked
        function markNotWorked(day) {
            const shiftsContainer = document.getElementById(`${day}-shifts`);
            shiftsContainer.innerHTML = "<p>Not worked.</p>";
            shifts[day] = [];
        }

        // Remove a shift
        function removeShift(button) {
            button.parentElement.remove();
        }

        // Save the week's data
        function saveWeek() {
            const weekData = {};
            weekdays.forEach(day => {
                const dayShifts = document.querySelectorAll(`#${day}-shifts .shift-container`);
                const dayData = [];
                dayShifts.forEach(shift => {
                    const start = shift.querySelector("input:nth-of-type(1)").value;
                    const end = shift.querySelector("input:nth-of-type(2)").value;
                    if (start && end) {
                        dayData.push({ start, end });
                    }
                });
                weekData[day] = dayData;
            });
            const weekStartDate = prompt("Enter the start date of the week (YYYY-MM-DD):");
            if (weekStartDate) {
                savedData.push({ weekStartDate, shifts: weekData });
                alert("Week's data saved!");
            }
        }

        // Calculate weekly earnings and tax
        function calculateEarnings() {
            let totalEarnings = 0;

            // Loop through each day's shifts
            weekdays.forEach(day => {
                const dayShifts = document.querySelectorAll(`#${day}-shifts .shift-container`);
                dayShifts.forEach(shift => {
                    const start = shift.querySelector("input:nth-of-type(1)").value;
                    const end = shift.querySelector("input:nth-of-type(2)").value;
                    const earning = calculateShiftEarnings(day, start, end);
                    totalEarnings += earning;
                });
            });

            // Calculate tax
            const taxData = calculateTax(totalEarnings);

            // Display results
            const output = document.getElementById("output");
            output.innerHTML = `
                <h3>Weekly Summary</h3>
                <p>Total Earnings: $${totalEarnings.toFixed(2)}</p>
                <p>Tax Deduction: $${taxData.tax.toFixed(2)} (${taxData.rate}%)</p>
                <p>Net Earnings: $${(totalEarnings - taxData.tax).toFixed(2)}</p>
            `;
        }

        // Calculate shift earnings based on rules
        function calculateShiftEarnings(day, start, end) {
            if (!start || !end) return 0;
            const startTime = parseFloat(start.replace(":", "."));
            const endTime = parseFloat(end.replace(":", "."));
            let hourlyRate = 32.07; // Default weekday rate

            if (["Saturday", "Sunday"].includes(day)) {
                hourlyRate = day === "Saturday" ? 38.48 : 44.89;
            }

            // Adjust for night and early morning shifts
            if ((startTime >= 4 && endTime <= 11.5) || (startTime >= 18 || endTime <= 11.5)) {
                hourlyRate += day === "Saturday" ? 6.41 : day === "Sunday" ? 6.42 : 7.69;
            }

            return (endTime - startTime) * hourlyRate;
        }

        // Calculate tax
        function calculateTax(income) {
            if (income <= 18200) return { tax: 0, rate: 0 };
            if (income <= 45000) return { tax: (income - 18200) * 0.16, rate: 16 };
            if (income <= 135000) return { tax: 4288 + (income - 45000) * 0.30, rate: 30 };
            if (income <= 190000) return { tax: 31288 + (income - 135000) * 0.37, rate: 37 };
            return { tax: 51638 + (income - 190000) * 0.45, rate: 45 };
        }

        // View saved historical data
        function viewHistory() {
            const output = document.getElementById("output");
            output.innerHTML = "<h3>Saved Data</h3>";
            savedData.forEach(data => {
                const shiftsSummary = weekdays.map(day => {
                    const shifts = data.shifts[day];
                    if (shifts && shifts.length) {
                        return `<strong>${day}:</strong> ${shifts.map(s => `${s.start} to ${s.end}`).join(", ")}`;
                    }
                    return `<strong>${day}:</strong> Not worked.`;
                }).join("<br>");
                output.innerHTML += `<p><strong>Week Starting:</strong> ${data.weekStartDate}<br>${shiftsSummary}</p>`;
            });
        }

        // Initialize the page
        initScheduler();
    </script>
</body>
</html>
